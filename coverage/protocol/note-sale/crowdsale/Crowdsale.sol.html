<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for protocol/note-sale/crowdsale/Crowdsale.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">protocol/note-sale/crowdsale/</a> Crowdsale.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.97% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>32/33</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>19/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.24% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>20/21</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.83% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>45/46</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
&nbsp;
import '../../../base/UntangledBase.sol';
import '../../../interfaces/ISecuritizationPool.sol';
import '../../../libraries/ConfigHelper.sol';
import '../../../interfaces/INoteToken.sol';
import '../../../interfaces/ICrowdSale.sol';
import '@openzeppelin/contracts/token/ERC20/ERC20.sol';
&nbsp;
abstract contract Crowdsale is UntangledBase, ICrowdSale {
    using ConfigHelper for Registry;
&nbsp;
    event UpdateTotalCap(uint256 totalCap);
&nbsp;
    Registry public registry;
&nbsp;
    // decimal calculating for rate
    uint256 public constant RATE_SCALING_FACTOR = 10**4;
&nbsp;
    /// @dev Pool address which this sale belongs to
    address public pool;
&nbsp;
    /// @dev The token being sold
    address public token;
    /// @dev The token being sold
    address public currency;
&nbsp;
    // How many token units a buyer gets per currency.
    uint256 public rate; // support by RATE_SCALING_FACTOR decimal numbers
    bool public hasStarted;
&nbsp;
    /// @dev Amount of currency raised
    uint256 internal _currencyRaised;
    
    /// @dev Amount of token raised
    uint256 public tokenRaised;
&nbsp;
    /// @dev Target raised currency amount
    uint256 public totalCap;
&nbsp;
    mapping(address =&gt; uint256) public _currencyRaisedByInvestor;
&nbsp;
    event TokensPurchased(address indexed purchaser, address indexed beneficiary, uint256 value, uint256 amount);
&nbsp;
    function __Crowdsale__init(
        Registry _registry,
        address _pool,
        address _token,
        address _currency
    ) internal <span class="missing-if-branch" title="else path not taken" >E</span>onlyInitializing {
        __UntangledBase__init_unchained(_msgSender());
        registry = _registry;
        pool = _pool;
        token = _token;
        currency = _currency;
    }
&nbsp;
    modifier securitizationPoolRestricted() {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_msgSender() == pool, 'Crowdsale: Caller must be pool');
        _;
    }
&nbsp;
    modifier smpRestricted() {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            _msgSender() == address(registry.getSecuritizationManager()),
            'Crowdsale: Caller must be securitization manager'
        );
        _;
    }
&nbsp;
    function currencyRaisedByInvestor(address investor) public view returns(uint256) {
        return _currencyRaisedByInvestor[investor];
    }
&nbsp;
    /// @notice add funding amount to be added to the total cap
    function addFunding(uint256 additionalCap) public <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>whenNotPaused {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            hasRole(OWNER_ROLE, _msgSender()) || <span class="branch-1 cbranch-no" title="branch not covered" >_msgSender() == address(registry.getSecuritizationManager())</span>,
            'Crowdsale: caller must be owner or pool'
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(additionalCap &gt; 0, 'Crowdsale: total cap is 0');
&nbsp;
        totalCap = additionalCap + totalCap;
&nbsp;
        emit UpdateTotalCap(totalCap);
    }
&nbsp;
    /// @notice Sets the rate variable to the new rate
    function _newSaleRound(uint256 newRate) internal {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!hasStarted, 'Crowdsale: Sale round overflow');
&nbsp;
        hasStarted = true;
        rate = newRate;
    }
&nbsp;
    /// @notice  Allows users to buy note token
    /// @param payee pay for purchase
    /// @param beneficiary wallet receives note token
    /// @param currencyAmount amount of currency used for purchase
    function buyTokens(
        address payee,
        address beneficiary,
        uint256 currencyAmount
    ) public <span class="missing-if-branch" title="else path not taken" >E</span>whenNotPaused <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>smpRestricted virtual returns (uint256) {
        uint256 tokenAmount = getTokenAmount(currencyAmount);
&nbsp;
        _preValidatePurchase(beneficiary, currencyAmount, tokenAmount);
&nbsp;
        // update state
        _currencyRaised += currencyAmount;
        _currencyRaisedByInvestor[beneficiary] += currencyAmount;
&nbsp;
        tokenRaised += tokenAmount;
&nbsp;
        _claimPayment(payee, currencyAmount);
        _processPurchase(beneficiary, tokenAmount);
        emit TokensPurchased(_msgSender(), beneficiary, currencyAmount, tokenAmount);
&nbsp;
        _forwardFunds(ISecuritizationPool(pool).pot(), currencyAmount);
&nbsp;
        return tokenAmount;
    }
&nbsp;
    /// @notice Check if the total amount of currency raised is equal to the total cap
    function isDistributedFully() public view returns (bool) {
        return _currencyRaised == totalCap;
    }
&nbsp;
    /// @notice Retrieves the remaining token balance held by the crowdsale contract
    function getTokenRemainAmount() public view returns (uint256) {
        return IERC20(token).balanceOf(address(this));
    }
&nbsp;
    /// @notice Calculates the remaining amount of currency available for purchase
    function getCurrencyRemainAmount() public view virtual returns (uint256) {
        return totalCap - _currencyRaised;
    }
&nbsp;
    /// @notice Determines whether the current sale round is a long sale
    /// @dev This is an abstract function that needs to be implemented in derived contracts
    function isLongSale() public view virtual returns (bool);
&nbsp;
    /// @notice Calculates the corresponding token amount based on the currency amount and the current rate
    /// @dev This is an abstract function that needs to be implemented in derived contracts
    function getTokenAmount(uint256 currencyAmount) public view virtual returns (uint256);
&nbsp;
    /// @notice Requires that the currency amount does not exceed the total cap
    function _defaultPreValidatePurchase(
        address beneficiary,
        uint256 currencyAmount,
        uint256 tokenAmount
    ) internal view {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(beneficiary != address(0), 'Crowdsale: beneficiary is zero address');
        //        require(currencyAmount != 0, "currency amount is 0");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(tokenAmount != 0, 'Crowdsale: token amount is 0');
        <span class="missing-if-branch" title="else path not taken" >E</span>require(isUnderTotalCap(currencyAmount), 'Crowdsale: cap exceeded');
    }
&nbsp;
    function _preValidatePurchase(
        address beneficiary,
        uint256 currencyAmount,
        uint256 tokenAmount
    ) internal view virtual {
        _defaultPreValidatePurchase(beneficiary, currencyAmount, tokenAmount);
    }
&nbsp;
    /// @dev Mints and delivers tokens to the beneficiary
    function _deliverTokens(address beneficiary, uint256 tokenAmount) internal {
        INoteToken(token).mint(beneficiary, tokenAmount);
    }
&nbsp;
    /// @dev Burns and delivers tokens to the beneficiary
<span class="fstat-no" title="function not covered" >    function _ejectTokens(uint256 tokenAmount) internal {</span>
<span class="cstat-no" title="statement not covered" >        INoteToken(token).burn(tokenAmount)</span>;
    }
&nbsp;
    function _processPurchase(address beneficiary, uint256 tokenAmount) internal {
        _deliverTokens(beneficiary, tokenAmount);
    }
&nbsp;
    /// @dev Transfers the currency from the payer to the crowdsale contract
    function _claimPayment(address payee, uint256 currencyAmount) internal {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            IERC20(currency).transferFrom(payee, address(this), currencyAmount),
            'Fail to transfer currency from payee to contract'
        );
    }
&nbsp;
    // function getTokenAmount(uint256 currencyAmount) public view returns (uint256) {
    //     require(rate &gt; 0, 'Crowdsale: rate is 0');
    //     uint256 TEN = 10;
    //     return
    //         (currencyAmount * rate * TEN**ERC20(token).decimals()) /
    //         (RATE_SCALING_FACTOR * TEN**ERC20(currency).decimals());
    // }
&nbsp;
    /// @dev Transfers the currency funds from the crowdsale contract to the specified beneficiary
    function _forwardFunds(address beneficiary, uint256 currencyAmount) internal {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(IERC20(currency).transfer(beneficiary, currencyAmount), 'Fail to transfer currency to Beneficiary');
    }
&nbsp;
    /// @dev Sets the total cap to the specified amount
    function _setTotalCap(uint256 cap) internal {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(cap &gt; 0, 'Crowdsale: cap is 0');
        <span class="missing-if-branch" title="else path not taken" >E</span>require(cap &gt;= _currencyRaised, 'Crowdsale: cap is bellow currency raised');
&nbsp;
        totalCap = cap;
&nbsp;
        emit UpdateTotalCap(totalCap);
    }
&nbsp;
    /// @notice Checks if the total amount of currency raised is greater than or equal to the total cap
    function totalCapReached() public view returns (bool) {
        return _currencyRaised &gt;= totalCap;
    }
&nbsp;
    /// @notice Checks if the sum of the current currency raised and the specified currency amount is less than or equal to the total cap
    function isUnderTotalCap(uint256 currencyAmount) public view returns (bool) {
        return _currencyRaised + currencyAmount &lt;= totalCap;
    }
&nbsp;
    function currencyRaised() public view virtual override returns (uint256) {
        return _currencyRaised;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Sep 20 2023 16:33:14 GMT+0700 (Indochina Time)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
